<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>3D Soccer Game</title>
<style>
  body { margin: 0; overflow: hidden; background: #111; }
  #hud {
    position: absolute;
    top: 10px; left: 50%;
    transform: translateX(-50%);
    color: white; font-family: Arial; font-size: 20px;
    text-align: center;
  }
</style>
</head>
<body>

<div id="hud">
  <div id="score">Home 0 - 0 Away</div>
  <div id="timer">03:00</div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

<script>
/* -------------------------------------------------------
   BASIC 3D SETUP
------------------------------------------------------- */
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x0b5f2a);

const camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 5000);
camera.position.set(0, 120, 220);

const renderer = new THREE.WebGLRenderer({ antialias: true });
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

/* -------------------------------------------------------
   LIGHTING
------------------------------------------------------- */
const light = new THREE.DirectionalLight(0xffffff, 1.2);
light.position.set(100, 200, 100);
scene.add(light);

scene.add(new THREE.AmbientLight(0xffffff, 0.4));

/* -------------------------------------------------------
   FIELD
------------------------------------------------------- */
const fieldGeo = new THREE.PlaneGeometry(400, 250);
const fieldMat = new THREE.MeshLambertMaterial({ color: 0x0b5f2a });
const field = new THREE.Mesh(fieldGeo, fieldMat);
field.rotation.x = -Math.PI / 2;
scene.add(field);

/* Lines */
function makeLine(w, h, x, z) {
  const geo = new THREE.PlaneGeometry(w, h);
  const mat = new THREE.MeshBasicMaterial({ color: 0xffffff });
  const line = new THREE.Mesh(geo, mat);
  line.rotation.x = -Math.PI/2;
  line.position.set(x, 0.1, z);
  scene.add(line);
}
makeLine(2, 250, 0, 0); // midline
makeLine(60, 60, 0, 0); // center circle

/* -------------------------------------------------------
   PLAYERS
------------------------------------------------------- */
function makePlayer(color) {
  const geo = new THREE.CapsuleGeometry(4, 12, 4, 8);
  const mat = new THREE.MeshLambertMaterial({ color });
  const mesh = new THREE.Mesh(geo, mat);
  mesh.position.y = 10;
  return mesh;
}

const homeTeam = [];
const awayTeam = [];

for (let i = 0; i < 5; i++) {
  const h = makePlayer(0x00d4ff);
  h.position.set(-120, 10, -80 + i * 40);
  homeTeam.push(h);
  scene.add(h);

  const a = makePlayer(0xff5252);
  a.position.set(120, 10, -80 + i * 40);
  awayTeam.push(a);
  scene.add(a);
}

/* -------------------------------------------------------
   BALL
------------------------------------------------------- */
const ballGeo = new THREE.SphereGeometry(5, 16, 16);
const ballMat = new THREE.MeshLambertMaterial({ color: 0xffffff });
const ball = new THREE.Mesh(ballGeo, ballMat);
ball.position.set(0, 5, 0);
scene.add(ball);

let ballVel = new THREE.Vector3(0, 0, 0);

/* -------------------------------------------------------
   GAME STATE
------------------------------------------------------- */
let scoreHome = 0;
let scoreAway = 0;
let possession = 0; // 0 home, 1 away
let remaining = 180; // 3 minutes
let lastTime = performance.now();

const scoreEl = document.getElementById("score");
const timerEl = document.getElementById("timer");

/* -------------------------------------------------------
   INPUT
------------------------------------------------------- */
const keys = {};
window.addEventListener("keydown", e => keys[e.key.toLowerCase()] = true);
window.addEventListener("keyup", e => keys[e.key.toLowerCase()] = false);

/* -------------------------------------------------------
   HOME PLAYER CONTROL
------------------------------------------------------- */
function controlHome() {
  const p = homeTeam[2]; // main controlled player
  let speed = 1.2;

  if (keys["w"]) p.position.z -= speed;
  if (keys["s"]) p.position.z += speed;
  if (keys["a"]) p.position.x -= speed;
  if (keys["d"]) p.position.x += speed;

  if (keys[" "]) {
    // shoot toward right goal
    ballVel.set(2.5, 0, (Math.random() - 0.5) * 1.2);
  }
}

/* -------------------------------------------------------
   SIMPLE AI
------------------------------------------------------- */
function aiAway() {
  const target = ball.position;
  const chaser = awayTeam[2];

  const dir = new THREE.Vector3().subVectors(target, chaser.position).normalize();
  chaser.position.add(dir.multiplyScalar(0.8));

  // AI shoots randomly
  if (Math.random() < 0.005) {
    ballVel.set(-2.5, 0, (Math.random() - 0.5) * 1.2);
  }
}

/* -------------------------------------------------------
   BALL PHYSICS
------------------------------------------------------- */
function updateBall() {
  ball.position.add(ballVel);
  ballVel.multiplyScalar(0.98);

  // boundaries
  if (ball.position.x > 200) ball.position.x = 200;
  if (ball.position.x < -200) ball.position.x = -200;
  if (ball.position.z > 120) ball.position.z = 120;
  if (ball.position.z < -120) ball.position.z = -120;

  // goal detection
  if (ball.position.x > 195 && Math.abs(ball.position.z) < 40) {
    scoreHome++;
    resetBall();
  }
  if (ball.position.x < -195 && Math.abs(ball.position.z) < 40) {
    scoreAway++;
    resetBall();
  }

  scoreEl.textContent = `Home ${scoreHome} - ${scoreAway} Away`;
}

function resetBall() {
  ball.position.set(0, 5, 0);
  ballVel.set(0, 0, 0);
}

/* -------------------------------------------------------
   TIMER
------------------------------------------------------- */
function updateTimer() {
  const now = performance.now();
  const delta = (now - lastTime) / 1000;
  lastTime = now;

  remaining -= delta;
  if (remaining < 0) remaining = 0;

  const m = Math.floor(remaining / 60);
  const s = Math.floor(remaining % 60);
  timerEl.textContent = `${String(m).padStart(2,"0")}:${String(s).padStart(2,"0")}`;
}

/* -------------------------------------------------------
   CAMERA FOLLOW
------------------------------------------------------- */
function updateCamera() {
  camera.position.lerp(
    new THREE.Vector3(ball.position.x, 120, ball.position.z + 200),
    0.05
  );
  camera.lookAt(ball.position);
}

/* -------------------------------------------------------
   MAIN LOOP
------------------------------------------------------- */
function animate() {
  requestAnimationFrame(animate);

  controlHome();
  aiAway();
  updateBall();
  updateTimer();
  updateCamera();

  renderer.render(scene, camera);
}

animate();
</script>

</body>
</html>
