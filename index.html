<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>3D Soccer Game (Fixed)</title>
<style>
  body { margin: 0; overflow: hidden; background: #111; }
  #hud {
    position: absolute;
    top: 10px; left: 50%;
    transform: translateX(-50%);
    color: white; font-family: Arial; font-size: 20px;
    text-align: center;
  }
</style>
</head>
<body>

<div id="hud">
  <div id="score">Home 0 - 0 Away</div>
  <div id="timer">03:00</div>
</div>

<!-- Updated Three.js CDN -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r155/three.min.js"></script>

<script>
/* -------------------------------------------------------
   BASIC 3D SETUP
------------------------------------------------------- */
const scene = new THREE.Scene();
scene.background = new THREE.Color(0x0b5f2a);

const camera = new THREE.PerspectiveCamera(
  60,
  window.innerWidth / window.innerHeight,
  0.1,
  5000
);

// GUARANTEED visible camera angle
camera.position.set(0, 200, 300);
camera.lookAt(0, 0, 0);

const renderer = new THREE.WebGLRenderer({ antialias: true });
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.shadowMap.enabled = true;
document.body.appendChild(renderer.domElement);

/* -------------------------------------------------------
   LIGHTING (stronger)
------------------------------------------------------- */
const sun = new THREE.DirectionalLight(0xffffff, 1.5);
sun.position.set(200, 300, 200);
sun.castShadow = true;
scene.add(sun);

scene.add(new THREE.AmbientLight(0xffffff, 0.5));

/* -------------------------------------------------------
   GRID (so you ALWAYS see something)
------------------------------------------------------- */
const grid = new THREE.GridHelper(500, 20, 0xffffff, 0xffffff);
grid.position.y = 0.1;
scene.add(grid);

/* -------------------------------------------------------
   FIELD
------------------------------------------------------- */
const fieldGeo = new THREE.PlaneGeometry(400, 250);
const fieldMat = new THREE.MeshLambertMaterial({ color: 0x0b5f2a });
const field = new THREE.Mesh(fieldGeo, fieldMat);
field.rotation.x = -Math.PI / 2;
field.receiveShadow = true;
scene.add(field);

/* -------------------------------------------------------
   PLAYERS
------------------------------------------------------- */
function makePlayer(color) {
  const geo = new THREE.CapsuleGeometry(5, 15, 4, 8);
  const mat = new THREE.MeshLambertMaterial({ color });
  const mesh = new THREE.Mesh(geo, mat);
  mesh.position.y = 12;
  mesh.castShadow = true;
  return mesh;
}

const homeTeam = [];
const awayTeam = [];

for (let i = 0; i < 5; i++) {
  const h = makePlayer(0x00d4ff);
  h.position.set(-120, 12, -80 + i * 40);
  homeTeam.push(h);
  scene.add(h);

  const a = makePlayer(0xff5252);
  a.position.set(120, 12, -80 + i * 40);
  awayTeam.push(a);
  scene.add(a);
}

/* -------------------------------------------------------
   BALL
------------------------------------------------------- */
const ballGeo = new THREE.SphereGeometry(6, 16, 16);
const ballMat = new THREE.MeshLambertMaterial({ color: 0xffffff });
const ball = new THREE.Mesh(ballGeo, ballMat);
ball.position.set(0, 6, 0);
ball.castShadow = true;
scene.add(ball);

let ballVel = new THREE.Vector3(0, 0, 0);

/* -------------------------------------------------------
   INPUT
------------------------------------------------------- */
const keys = {};
window.addEventListener("keydown", e => keys[e.key.toLowerCase()] = true);
window.addEventListener("keyup", e => keys[e.key.toLowerCase()] = false);

/* -------------------------------------------------------
   HOME CONTROL
------------------------------------------------------- */
function controlHome() {
  const p = homeTeam[2];
  const speed = 1.2;

  if (keys["w"]) p.position.z -= speed;
  if (keys["s"]) p.position.z += speed;
  if (keys["a"]) p.position.x -= speed;
  if (keys["d"]) p.position.x += speed;

  if (keys[" "]) {
    ballVel.set(3, 0, (Math.random() - 0.5) * 2);
  }
}

/* -------------------------------------------------------
   AI
------------------------------------------------------- */
function aiAway() {
  const chaser = awayTeam[2];
  const dir = new THREE.Vector3().subVectors(ball.position, chaser.position).normalize();
  chaser.position.add(dir.multiplyScalar(0.8));

  if (Math.random() < 0.005) {
    ballVel.set(-3, 0, (Math.random() - 0.5) * 2);
  }
}

/* -------------------------------------------------------
   BALL PHYSICS
------------------------------------------------------- */
function updateBall() {
  ball.position.add(ballVel);
  ballVel.multiplyScalar(0.98);

  // boundaries
  ball.position.x = Math.max(-200, Math.min(200, ball.position.x));
  ball.position.z = Math.max(-120, Math.min(120, ball.position.z));
}

/* -------------------------------------------------------
   CAMERA FOLLOW
------------------------------------------------------- */
function updateCamera() {
  const target = new THREE.Vector3(ball.position.x, 200, ball.position.z + 300);
  camera.position.lerp(target, 0.05);
  camera.lookAt(ball.position);
}

/* -------------------------------------------------------
   MAIN LOOP
------------------------------------------------------- */
function animate() {
  requestAnimationFrame(animate);

  controlHome();
  aiAway();
  updateBall();
  updateCamera();

  renderer.render(scene, camera);
}

animate();
</script>

</body>
</html>
